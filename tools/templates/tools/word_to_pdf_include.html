{% extends 'base2.html' %}
{% load i18n %}
{% load static %}


{% comment %} {% block title%} Word to PDF Converter {% endblock %} {% endcomment %}

{% block content %}
<div class="container poppins-regular text-center">
    <p class="roboto-bold text-uppercase fs-1">{% trans 'w2ptitle' %}</p>
    <hr><br>
    <p class="roboto-bold text-uppercase fs-2">{% trans 'w2psubtitle' %}</p>
    <br>
    <div class="container">
        <form id="word-to-pdf-form" class="form-control align-items-center p-5 mt-5" method="post" enctype="multipart/form-data" action="{% url 'tools:word_to_pdf_include' %}">
            {% csrf_token %}
            <label for="word_file" class="btn btn-primary btn-lg">
                <span id="file-label"><b>{% trans 'Upload' %} WORD File</b></span>
                <input id="word_file" class="visually-hidden" type="file" name="word_file" accept=".docx,.doc,.txt" required onchange="updateFileName(this)">
            </label>
            <br><p>{% trans 'w2prest' %}<br><br>
            <button class="btn btn-danger btn-lg" type="submit">{% trans 'Convert' %}</button>
        </form>
    </div>
    <div class="container">
        {% if tool_attachment %} 
        <div class="tool-body">
             {{ tool_attachment.body|safe }} 
        </div>
       <br>
        {% endif %}
    </div>
</div>

<script>
    function updateFileName(input) {
        var fileName = input.files[0].name;
        document.getElementById('file-label').innerText = fileName;
    }

    document.getElementById('convert-btn').addEventListener('click', function() {
        var form = document.getElementById('word-to-pdf-form');
        var formData = new FormData(form);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', form.action);
        xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
        xhr.responseType = 'blob';
        xhr.onload = function() {
            if (xhr.status === 200) {
                var blob = new Blob([xhr.response], { type: 'application/pdf' });
                var url = window.URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'converted.pdf';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
            }
        };
        xhr.send(formData);
    });
</script>
{% endblock %}
